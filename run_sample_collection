#!/bin/bash

# total permitted number
n=$1; shift
[ -z "$n" ] && n=10

make -j4
mkdir -p data

generate_samples() {
  total_no=$1; shift
  for p in 2; do
    for q in 3; do
      for r in 7 8 9; do
        c=0 # count existing files
        for i in data/cg_system_${p}-${q}-${r}*; do
          ((++c))
        done

        maxthreads=4
        no_threads=0
        for i in $(seq $c $((total_no-1))); do
          [ "$no_threads" -ge "$max_threads" ] && {
            wait
            no_threads=0
          }
          ./ss_generator $p $q $r &
          ((++no_threads))
        done
        wait
        no_threads=0
      done
    done
  done
}

for i in {1..10}; do
  generate_samples "$n"
done

for i in data/cg_system*; do
  output="${i/cg_system/cg_hr}"
  [ -e "${output}" ] && continue
  ./ss_cat "${i}" > "$output"
done

# ./run_cg_generation
# ./run_cg_visualization
